<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Duck Hunt</title>
<link rel="icon" type="image/jpeg" href="../assets/img/pixelated-duck.jpg" />
  <style>
    body {
      margin: 0;
      background: #87CEEB;
      font-family: "Press Start 2P", monospace;
      color: #333;
      text-align: center;
      user-select: none;
      overflow: hidden;
    }
    h1 { margin: 10px 0; }
    #hud {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 0.8em;
      margin-bottom: 6px;
    }
    #gameCanvas {
      display: block;
      margin: 0 auto;
      border: 3px solid #333;
      background: #87CEEB;
    }
    .pill {
      background: #ffffffaa;
      padding: 6px 10px;
      border-radius: 10px;
    }
    #timerBarContainer {
      width: 300px;
      height: 16px;
      background: #ddd;
      border: 2px solid #333;
      margin: 0 auto 8px auto;
      border-radius: 8px;
      overflow: hidden;
    }
    #timerBar {
      height: 100%;
      width: 100%;
      background: linear-gradient(to right, #32CD32, #FFD700, #FF4500);
      transition: width 0.2s linear;
    }
    @keyframes flashRed {
      0% { background: #FF0000; }
      50% { background: #8B0000; }
      100% { background: #FF0000; }
    }
    .flash { animation: flashRed 0.5s infinite; }
    @keyframes flashText {
      0% { color: #FF0000; }
      50% { color: #8B0000; }
      100% { color: #FF0000; }
    }
    .flashText { animation: flashText 0.5s infinite; font-weight: bold; }
    #overlay, #pauseOverlay, #menuOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #menuOverlay { display: flex; z-index: 1000; }
    /* Bright flash overlay used when a new round starts */
    #newRoundFlash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 1500;
      mix-blend-mode: screen;
    }
    @keyframes newRoundFlashKey {
      0% { opacity: 0; }
      8% { opacity: 0.95; }
      35% { opacity: 0.4; }
      100% { opacity: 0; }
    }
    /* Round label that appears with the flash (same-page inline) */
    #roundLabel {
      position: fixed;
      left: 50%;
      top: 18%;
      transform: translateX(-50%) translateY(-20px);
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 18px;
      letter-spacing: 1px;
      z-index: 1600;
      opacity: 0;
      pointer-events: none;
      font-family: "Press Start 2P", monospace;
    }
    @keyframes roundLabelPop {
      0% { opacity: 0; transform: translateX(-50%) translateY(-40px) scale(0.95); }
      12% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.05); }
      60% { opacity: 1; transform: translateX(-50%) translateY(-6px) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-20px) scale(0.95); }
    }
    #overlayContent, #pauseContent, #menuContent {
      background: #fff;
      padding: 20px 40px;
      border-radius: 12px;
      text-align: center;
      font-family: "Press Start 2P", monospace;
      color: #333;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #restartBtn, #startBtn { background: #87CEEB; }
    #resumeBtn { background: #87CEEB; }
    #quitBtn { background: #FF6347; color: #fff; }
    #scoresBtn { background: #FFD700; }
    #muteBtn {
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
    }
.other-link {
  display: inline-block;
  margin: 10px 0;
  padding: 12px 20px;
  font-weight: 600;
  text-decoration: none;
  border-radius: 6px;
  background-color: #f5f5f5; /* light gray background */
  color: #333; /* dark gray text */
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
}

/* Anime link style */
.other-link[href*="index.html"] {
  background-color: #ffffff; /* white */
  color: #1c2b4d; /* navy text */
  border: 1px solid #ccc;
}

.other-link[href*="index.html"]:hover {
  background-color: #e6e6e6; /* soft gray hover */
  color: #000; /* black text */
  transform: translateY(-2px);
}

/* Duck Hunt link style */
.other-link[href*="DuckHunt.html"] {
  background-color: #e0f0ff; /* pale blue */
  color: #004080; /* deep blue text */
  border: 1px solid #99c2ff;
}

.other-link[href*="DuckHunt.html"]:hover {
  background-color: #cce0ff; /* slightly darker blue */
  color: #00264d; /* darker navy text */
  transform: translateY(-2px);
}
 </style>
</head>
<body>
  <h1>Duck Hunt</h1>
  <div id="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Level: <span id="level">1</span></div>
    <div class="pill">Kills: <span id="kills">0</span>/5</div>
    <div class="pill">Time: <span id="timer">20</span>s</div>
    <div class="pill"><button id="muteBtn">üîä</button></div>
  </div>
  <div id="timerBarContainer"><div id="timerBar"></div></div>
  <canvas id="gameCanvas" width="800" height="480"></canvas>

  <!-- Overlays -->
  <div id="overlay"><div id="overlayContent">
    <h2 id="overlayTitle"></h2>
    <p id="overlayMessage"></p>
    <button id="restartBtn">Restart</button>
  </div></div>

  <div id="pauseOverlay"><div id="pauseContent">
    <h2>‚è∏ Paused</h2>
    <p>Press P again or click Resume</p>
    <button id="resumeBtn">Resume</button>
    <button id="quitBtn">Quit to Main Menu</button>
  </div></div>

  <div id="menuOverlay"><div id="menuContent">
    <h2>Duck Hunt</h2>
    <button id="startBtn">Start Game</button>
    <button id="scoresBtn">View High Scores</button>
    <div id="scoresPanel" style="display:none; margin-top:15px;">
      <h3>High Scores</h3>
      <p id="scoresList">No scores yet</p>
    </div>
  </div></div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const levelEl = document.getElementById("level");
    const killsEl = document.getElementById("kills");
    const timerEl = document.getElementById("timer");

    const pistol = { x: canvas.width/2, y: canvas.height-40, w:24, h:10 };
    let ducks = [];
    let score=0, level=1, killsThisLevel=0;
    let lastSpawn=0, spawnInterval=1800, flash=null;
    let roundTime=20, timeLeft=20, roundStart, totalTime=0;
    let lastTime=performance.now();
    let paused=false;
    let muted=false;

    const sounds = {
      shoot: new Audio("shoot.wav"),
      hit: new Audio("hit.wav"),
      gameover: new Audio("gameover.wav"),
      victory: new Audio("victory.wav")
    };
    const bgMusic = new Audio("bgmusic.mp3");
    bgMusic.loop=true; bgMusic.volume=0.3;

    function clampPistol() {
      pistol.x = Math.max(0, Math.min(canvas.width-pistol.w, pistol.x));
      pistol.y = Math.max(60, Math.min(canvas.height-pistol.h, pistol.y));
    }

    // Background
    function drawGrass() {
      ctx.fillStyle="#228B22";
      ctx.fillRect(0,canvas.height-40,canvas.width,40);
      ctx.fillStyle="#006400";
      for(let i=0;i<canvas.width;i+=8){
        ctx.fillRect(i,canvas.height-40-Math.random()*10,4,10);
      }
    }
    let clouds=[{x:100,y:80},{x:400,y:60},{x:700,y:100}];
    function drawClouds(){
      ctx.fillStyle="white";
      for(let c of clouds){
        ctx.beginPath(); ctx.ellipse(c.x,c.y,40,20,0,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(c.x+30,c.y+10,30,15,0,0,Math.PI*2); ctx.fill();
        c.x+=0.2; if(c.x>canvas.width+50) c.x=-50;
      }
    }
    function drawTrees(){
      const baseY=canvas.height-110; const trunks=[90,310,530,730];
      for(let x of trunks){
        ctx.fillStyle="#8B4513"; ctx.fillRect(x,baseY,24,110);
        ctx.fillStyle="#90EE90";
        ctx.beginPath(); ctx.arc(x+12,baseY,50,0,Math.PI*2); ctx.fill();
      }
    }
    function drawPistol(){
      ctx.fillStyle="#8B4513";
      ctx.fillRect(pistol.x,pistol.y,pistol.w,pistol.h);
      ctx.fillRect(pistol.x+6,pistol.y-16,10,16);
      ctx.fillStyle="#5c3317";
      ctx.fillRect(pistol.x+6,pistol.y-16,10,4);
    }

    // Ducks
    function spawnDuck(){
      const fromLeft=Math.random()<0.5;
      const y=60+Math.random()*(canvas.height-200);
      const w=30,h=20;
      const vx=fromLeft?2.5:-2.5;
      ducks.push({x:fromLeft?-40:canvas.width+40,y,w,h,vx,flap:0,falling:false});
    }
    function updateDucks(delta){
      for(let d of ducks){
        if(d.falling){ d.y+=d.vy*(delta/16); }
        else { d.x+=d.vx*(delta/16); d.flap+=delta; }
      }
      ducks=ducks.filter(d=>d.x>-80&&d.x<canvas.width+80&&d.y<canvas.height+50);
    }
    function drawDuck(d){
      const {x,y,w,h,vx,flap,falling}=d;
      ctx.fillStyle=falling?"darkred":"grey";
      ctx.beginPath(); ctx.ellipse(x,y,w/2,h/2,0,0,Math.PI*2); ctx.fill();
      if(!falling){
        const wingUp=Math.floor(flap/200)%2===0;
        ctx.fillStyle="darkgrey"; ctx.beginPath();
        if(wingUp){ ctx.moveTo(x-4,y); ctx.lineTo(x+(vx>0?14:-14),y-20); ctx.lineTo(x+(vx>0?10:-10),y-2); }
        else { ctx.moveTo(x-4,y); ctx.lineTo(x+(vx>0?14:-14),y+10); ctx.lineTo(x+(vx>0?10:-10),y+2); }
        ctx.closePath(); ctx.fill();
      }
      ctx.fillStyle=falling?"orange":"green";
      ctx.beginPath(); ctx.arc(x+(vx>0?w/2+8:-w/2-8),y-6,8,0,Math.PI*2); ctx.fill();
      ctx.fillStyle="orange"; ctx.beginPath();
      const hx=x+(vx>0?w/2+8:-w/2-8);
      ctx.moveTo(hx+(vx>0?8:-8),y-6);
      ctx.lineTo(hx+(vx>0?16:-16),y-8);
      ctx.lineTo(hx+(vx>0?12:-12),y-4);
      ctx.closePath(); ctx.fill();
    }
// Track total elapsed time across rounds
let totalElapsed = 0;

// Reset timer for a new round
function resetRoundTimer() {
  // Calculate how much time passed in the previous round
  const elapsed = roundTime - timeLeft;
  totalElapsed += elapsed;   // add it to the running total

  // Reset for the new round
  roundStart = performance.now();
  timeLeft   = roundTime;
  timerEl.textContent = timeLeft;
  // tiny visual cue for the new round
  try{ showNewRoundFlash(); }catch(e){}

  // Optional: show total elapsed in console or HUD
  console.log("Total elapsed so far:", totalElapsed, "seconds");
}

// Fire
function fire(){
  flash = { x:pistol.x+pistol.w, y:pistol.y, time:performance.now() };
  if(!muted){ sounds.shoot.currentTime=0; sounds.shoot.play(); }

  for(let d of ducks){
    const coneLeft=pistol.x-10, coneRight=pistol.x+70;
    const coneTop=pistol.y-40, coneBottom=pistol.y+10;
    const duckLeft=d.x-d.w/2, duckRight=d.x+d.w/2;
    const duckTop=d.y-d.h/2, duckBottom=d.y+d.h/2;

    if(duckRight>coneLeft && duckLeft<coneRight && duckBottom>coneTop && duckTop<coneBottom){
      d.falling=true; d.vx=0; d.vy=4;
      if(!muted){ sounds.hit.currentTime=0; sounds.hit.play(); }
      score++; killsThisLevel++;
      scoreEl.textContent=score; killsEl.textContent=killsThisLevel;

      if(killsThisLevel>=5){
        level++; killsThisLevel=0;
        levelEl.textContent=level; killsEl.textContent=killsThisLevel;

        resetRoundTimer();   // <-- resets and totals elapsed time

        if(level>6){ endRound(true); return; }
      }
      break;
    }
  }
}
// End round
    function endRound(cleared){
      const overlay=document.getElementById("overlay");
      const title=document.getElementById("overlayTitle");
      const message=document.getElementById("overlayMessage");
      if(cleared&&level>6){
        totalTime+=(roundTime-timeLeft);
        if(!highScore||totalTime<highScore){
          highScore=totalTime; localStorage.setItem("duckHighScore",highScore);
        }
        highScoreEl.textContent=highScore.toFixed(1)+"s";
        title.textContent="üéâ Victory!";
        message.textContent="You cleared all rounds in "+totalTime.toFixed(1)+" seconds!";
        if(!muted) sounds.victory.play();
      } else if(!cleared){
        title.textContent="‚è∞ Time‚Äôs Up!";
        message.textContent="Game over. Try again!";
        if(!muted) sounds.gameover.play();
      }
      overlay.style.display="flex"; bgMusic.pause();
    }

    // Loop
    function loop(now){
      if(paused) return;
      const delta=now-lastTime; lastTime=now;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawClouds(); drawTrees(); drawGrass(); drawPistol();
      updateDucks(delta); ducks.forEach(drawDuck);
      if(flash&&now-flash.time<100){
        ctx.fillStyle="yellow"; ctx.fillRect(flash.x,flash.y-4,20,8);
      }
      if(now-lastSpawn>spawnInterval){ spawnDuck(); lastSpawn=now; }
      timeLeft=roundTime-Math.floor((now-roundStart)/1000);
      timerEl.textContent=timeLeft;
      const bar=document.getElementById("timerBar");
      bar.style.width=(timeLeft/roundTime*100)+"%";
      if(timeLeft<=5){ bar.classList.add("flash"); timerEl.classList.add("flashText"); }
      else { bar.classList.remove("flash"); timerEl.classList.remove("flashText"); }
      if(timeLeft<=0){ endRound(false); return; }
      requestAnimationFrame(loop);
    }

    // Controls
    document.addEventListener("keydown",e=>{
      if(e.key==="ArrowLeft") pistol.x-=20;
      if(e.key==="ArrowRight") pistol.x+=20;
      if(e.key==="ArrowUp") pistol.y-=20;
      if(e.key==="ArrowDown") pistol.y+=20;
      if(e.code==="Space") fire();
      if(e.key==="p"||e.key==="P"){
        paused=!paused;
        document.getElementById("pauseOverlay").style.display=paused?"flex":"none";
        if(!paused){
          lastTime=performance.now();
          roundStart=performance.now()-(roundTime-timeLeft)*1000;
          requestAnimationFrame(loop);
        }
      }
      clampPistol();
    });

    // Optional mouse aiming
    canvas.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      pistol.x = e.clientX - rect.left - pistol.w/2;
      pistol.y = e.clientY - rect.top - pistol.h/2;
      clampPistol();
    });

    // Buttons
    document.getElementById("restartBtn").addEventListener("click",()=>{ document.getElementById("overlay").style.display="none"; start(); });
    document.getElementById("resumeBtn").addEventListener("click",()=>{ paused=false; document.getElementById("pauseOverlay").style.display="none"; lastTime=performance.now(); roundStart=performance.now()-(roundTime-timeLeft)*1000; requestAnimationFrame(loop); });
    document.getElementById("quitBtn").addEventListener("click",()=>{ paused=false; document.getElementById("pauseOverlay").style.display="none"; document.getElementById("menuOverlay").style.display="flex"; bgMusic.pause(); });
    document.getElementById("startBtn").addEventListener("click",()=>{ document.getElementById("menuOverlay").style.display="none"; start(); });
    document.getElementById("scoresBtn").addEventListener("click",()=>{
      const panel=document.getElementById("scoresPanel");
      const list=document.getElementById("scoresList");
      panel.style.display=panel.style.display==="none"?"block":"none";
      const hs=localStorage.getItem("duckHighScore");
      list.textContent=hs?parseFloat(hs).toFixed(1)+" seconds":"No scores yet";
    });
    document.getElementById("muteBtn").addEventListener("click",()=>{
      muted=!muted; const btn=document.getElementById("muteBtn");
      btn.textContent=muted?"üîá":"üîä";
      for(let k in sounds){ sounds[k].muted=muted; }
      bgMusic.muted=muted;
    });

    // Visual cue: quick screen flash to indicate the start of a new round
    function showNewRoundFlash(){
      let el = document.getElementById('newRoundFlash');
      if(!el){ el = document.createElement('div'); el.id = 'newRoundFlash'; document.body.appendChild(el); }
      el.style.animation = 'none';
      // force reflow so animation restarts
      // eslint-disable-next-line no-unused-expressions
      void el.offsetWidth;
      el.style.animation = 'newRoundFlashKey 700ms ease-out forwards';
      // Round label (same-page) showing current round/level
      let lbl = document.getElementById('roundLabel');
      if(!lbl){ lbl = document.createElement('div'); lbl.id = 'roundLabel'; document.body.appendChild(lbl); }
      lbl.textContent = 'Round ' + level;
      lbl.style.animation = 'none';
      // restart label animation
      // eslint-disable-next-line no-unused-expressions
      void lbl.offsetWidth;
      lbl.style.animation = 'roundLabelPop 900ms cubic-bezier(.2,.9,.2,1) forwards';
    }

    // Start
    function start(){
      score=0; level=1; killsThisLevel=0;
      scoreEl.textContent=0; levelEl.textContent=1; killsEl.textContent=0;
      roundTime=20; timeLeft=20; totalTime=0; ducks=[]; lastSpawn=0;
      roundStart=performance.now(); lastTime=performance.now();
      try{ showNewRoundFlash(); }catch(e){}
      bgMusic.currentTime=0; if(!muted) bgMusic.play();
      requestAnimationFrame(loop);
    }
  </script>
  <br>
  <br>
  <a href="../index.html" target="_blank" class="other-link">Why should I give Anime a chance?</a>
    <br>
    <a href="../resume.html" target="_blank" class="other-link"> Gattlin Rogers Resume</a>
</body>
</html>